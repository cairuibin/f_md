<!doctype html>
<html>

<head>
    <meta charset="utf-8" />
    <title>blog_c</title>
    <link rel="stylesheet" href="./heightlight/styles/atelier-lakeside-dark.css">
    <link href="./heightlight/prism.css" rel="stylesheet">
    <script src="./js/axios.js"></script>
    <script src="./js/vue.js"></script>
    <style>
        #content {
            max-width: 960px;
            margin: auto;
        }

        .hljs {
            background: #000;
        }
    </style>
</head>

<body>
    <div id="app">
        <input type="file" ref='fileElem' accept="*" style="display:none" @change="handleFiles">
        <button @click='selectFile'>选择文件</button>
        <div id="content" ref='content' v-html="htmlData"> </div>
        {{filelist}}
    </div>
    <script>
        new Vue({
            el: "#app",
            data: {
                htmlData: "",
                filelist: []
            },
            created() {
                this.getHtml();
                this.getfilelist()
            },
            methods: {
                async getHtml() {
                    const { data } = await axios.get('/html');
                    this.htmlData = await data.replace(/<pre>/g, '<pre class="hljs">');
                },
                selectFile() {
                    this.$refs.fileElem.click()
                },

                handleFiles(e) {
                    const files = e.target.files
                    console.log(files);

                    this.FileUpload(files[0])
                },
                async FileUpload(file) {
                    const uri = "/FileUpload";
                    const fd = new FormData();
                    fd.append('file', file);
                    const res = await axios.post(uri, fd, {
                        headers: {
                            'Content-Type': "application/x-www-form-urlencoded"
                        }
                    })
                },
                async getfilelist() {
                    const uri = "/filelist";
                    const res = await axios.post(uri)

                    this.filelist = res
                }
            }
        })
    </script>
</body>

</html>